
/*
 * File: z_bg_haka.c from OoT
 * Overlay: ovl_Bg_Haka
 * Description: Gravestone
 */

#include "z_bg_haka.h"
#include "proxymm_custom_actor.h"
#include "recomp_api.h"
#include "z64extern.h"

#define FLAGS 0

void BgHaka_Init(Actor* thisx, PlayState* play);
void BgHaka_Destroy(Actor* thisx, PlayState* play);
void BgHaka_Update(Actor* thisx, PlayState* play);
void BgHaka_Draw(Actor* thisx, PlayState* play);

void BgHaka_CheckPlayerOnDirtPatch(BgHaka* this, Player* player);
void BgHaka_IdleClosed(BgHaka* this, PlayState* play);
void BgHaka_Pull(BgHaka* this, PlayState* play);
void BgHaka_IdleOpened(BgHaka* this, PlayState* play);
void BgHaka_IdleLockedClosed(BgHaka* this, PlayState* play);

ActorProfile Bg_Haka_Profile = {
    /**/ /*ACTOR_BG_HAKA*/ ACTOR_ID_MAX,
    /**/ ACTORCAT_BG,
    /**/ FLAGS,
    /**/ /*OBJECT_HAKA*/ GAMEPLAY_KEEP,
    /**/ sizeof(BgHaka),
    /**/ BgHaka_Init,
    /**/ BgHaka_Destroy,
    /**/ BgHaka_Update,
    /**/ BgHaka_Draw,
};

s16 CUSTOM_ACTOR_BG_HAKA = ACTOR_ID_MAX;

RECOMP_CALLBACK("*", recomp_on_init) 
void BgHaka_OnRecompInit() {
    CUSTOM_ACTOR_BG_HAKA = CustomActor_Register(&Bg_Haka_Profile);
}

// @ProxyMM Example spawning this actor in south clock town.
RECOMP_HOOK("Actor_SpawnTransitionActors")
void BgHaka_OnRoomLoad(PlayState* play, ActorContext* actorCtx) {
    if (play->sceneId == SCENE_CLOCKTOWER) {
        Actor_SpawnAsChildAndCutscene(&play->actorCtx, play, CUSTOM_ACTOR_BG_HAKA, -367.0f, 0.0f, -245.0f, 0, 0x8000, 0, 0, 0, 0, 0);
    }
}

/* BEGIN OBJECT_HAKA */

Vtx object_hakaVtx_000000[] = {
    VTX(286, 144, 290, -876, 501, 80, 72, 52, 255),
	VTX(288, 0, -360, 256, 1024, 102, 23, 198, 255),
	VTX(250, 480, -360, 312, 0, 80, 77, 212, 255),
	VTX(286, 144, 290, -876, 501, 80, 72, 52, 255),
	VTX(346, 0, 360, -1025, 1024, 76, 64, 67, 255),
	VTX(288, 0, -360, 256, 1024, 102, 23, 198, 255),
	VTX(250, 480, -360, 383, 0, 80, 77, 212, 255),
	VTX(288, 0, -360, 314, 589, 102, 23, 198, 255),
	VTX(-288, 0, -360, 1363, 589, 154, 21, 198, 255),
	VTX(-250, 480, -360, 1294, 0, 176, 77, 211, 255),
	VTX(-250, 480, -360, 1055, 0, 176, 77, 211, 255),
	VTX(-288, 0, -360, 1111, 1024, 154, 21, 198, 255),
	VTX(-290, 144, 290, 2243, 501, 176, 72, 52, 255),
	VTX(-288, 0, -360, 1111, 1024, 154, 21, 198, 255),
	VTX(-346, 0, 360, 2392, 1024, 179, 62, 67, 255),
	VTX(-346, 0, 360, 0, 1024, 179, 62, 67, 255),
	VTX(346, 0, 360, 1125, 1024, 76, 64, 67, 255),
	VTX(286, 144, 290, 1125, 496, 80, 72, 52, 255),
	VTX(-290, 144, 290, 0, 496, 176, 72, 52, 255),
	VTX(-290, 144, 290, -1024, 1024, 176, 72, 52, 255),
	VTX(286, 144, 290, 1024, 1024, 80, 72, 52, 255),
	VTX(250, 480, -360, 1024, 0, 80, 77, 212, 255),
	VTX(-250, 480, -360, -1024, 0, 176, 77, 211, 255),

	VTX(-346, 0, -360, 1024, 1024, 0, 120, 0, 255),
	VTX(346, 0, -360, 1024, 0, 0, 120, 0, 255),
	VTX(346, 0, -1128, 0, 0, 0, 120, 0, 255),
	VTX(-346, 0, -1128, 0, 1024, 0, 120, 0, 255),
};

u64 gGravestoneGrassTex[] = {
    0xB569AD27C5EBBD67, 0xACE5B527ACE59CA3, 0xBDA7D62DA49FBD67, 0xAD25AD25BD69BD67,
    0xB527B5ABB569BDAB, 0xACE5ACE59CE59CA3, 0xB525CDEBA4E3AD25, 0xACE5A4E3B525BDAB,
    0xC5ABD5EBB527A4E5, 0xBDEDBD69AD69A4E5, 0xAD25AD25AD27BDA9, 0xD62FACE39CA1B525,
    0xBD69AD25ACE5B5AB, 0xA4E59CA3AD29C5ED, 0x9CA3AD25BDA9C5AB, 0xA4A3BD698BDD9C5F,
    0x9CA3AD25A4E3B569, 0xB527BD69AD25A4E5, 0x83DD9CA3BDEDBD69, 0xACE59CA39CA3A4E5,
    0xBD69ACE59C619CA3, 0xACE5BD29841F8C1F, 0x9C619CA3A4E59CA3, 0x9CE59CA3A4E5A4E5,
    0xBD29B569A4E3A4E5, 0x9CA3BDAB9CA3A4A3, 0xBD698BDDB527BD69, 0xAD69A4E5A4A3B569,
    0xBDABB5699461A4A3, 0xA4E3A4E5AD25ACE5, 0x9CA39CA3ACE5BD29, 0xAD29C5EDB527AD27,
    0xACE59CA3AD259C61, 0xA4E5B5AB9CE59CE5, 0x9CA3A4E59CA3BDAB, 0xAD25A4E5AD27C5EB,
    0x9CA3A4E3A4E59CE3, 0xA4E3B5699CA3AD69, 0xA4E5A4A3A4E3ACE5, 0xA4E3A4E5B5ABB569,
    0xA461A4E5BDABBDAB, 0xA4E5A4E59CA3AD29, 0xC5EDB527A4A19CA3, 0xB569D62FD5EBB527,
    0x9CE594A3A4A5BDA9, 0xBD69A4A39CA3AD25, 0xA4E5AD27A4E3A461, 0xB569C5ABAD25ACE5,
    0x94A38C619461BD67, 0xB5259C61AD27A4E3, 0xA4E5B5AB9CE59CE5, 0xA4E39C61AD25A4E3,
    0x9CE3A4A39461A4A1, 0xBD679CE3ACE5A4E3, 0xA4E5C5ED9CA3AD69, 0x9CA5B569ACE59C61,
    0xA4E5A4E5941FA4A3, 0xA4A1B5259CA3B569, 0xD62FC62DAD27B569, 0xC5EDBDABB569A4E3,
    0xAD27A4E5A4E5C5AB, 0xA4A1ACE5A461B569, 0xC5ABB569841FAD29, 0xAD27B569B5699461,
    0x9C61C5ABB567BDA9, 0xC5EBC5AB9CE5A4E3, 0x9C618C1F9CA3A527, 0xBDABB569BDABACE7,
    0x8C1FBDABBDABB569, 0xBDA9A4E5AD699CA5, 0xB5699CE38C5F9CE5, 0xAD29A529A527A4E5,
    0xA4E5B5ABAD27B567, 0x9CE3AD25B569C5ED, 0xBDABA4E373598461, 0xA4E7A4E58C1FB527,
    0x83DDAD29BD6BAD27, 0xA4E5A4A3A4E59CE7, 0xC5ABA4E38C6194A3, 0x9CA5C5EFBD6BAD69,
    0x8BDF94A3B569AD27, 0xA4E3AD25B5278C61, 0xBD67A4E39CA3A527, 0x7BDDAD29AD699463,
    0x9461A4A5A5259CA3, 0x7BD9BDA99C619CA1, 0x9C9F8BDD8C5FA4E5, 0x73978C5FA4E58C61,
    0x94A1BD6994A19CE5, 0x841B949DBDA9A4E5, 0x8C5F945D945F9461, 0x62D38C619CA3AD27,
    0x7B999CA3B567AD27, 0x5B13A525A525949F, 0x9C9F83D79C617B99, 0x73578C1D8C1D83DF,
    0x52D1841D9CA352D1, 0x73DB94A184179CDF, 0x949D7393941F9461, 0x634F7BDB83D77B5B,
    0x4A4F735B83DD52CD, 0xA5279CE36B8FA525, 0x7391841783DB52CB, 0x6B5563157BD9839B,
    0x6B57946194617BD3, 0xB56994A16B4FB565, 0x6B9183D9A4E3424B, 0x73997BDB8C1D7BDF,
    0x5B5194617BD76B51, 0xA5257BD95B0F7395, 0x52CD9CE16B95424B, 0x94A18C5D6351739B,
    0x4A8B7B9962CF7355, 0x83D78C5B63517C19, 0x635184196B936B51, 0x7BD784194ACD841B,
    0x634D7BD5528B6B51, 0x7391634F63116B53, 0x734F634F5B0D52CD, 0x7BD57BD54ACB6353,
    0x5B0D52CB528D634F, 0x5ACD5B0D5B0D634F, 0x5ACD6B9152CB5B0D, 0x6B4F634F4A8B6B53,
    0x4A8B630D5ACB6B8F, 0x5B0D5B0F6B8F5B0D, 0x5B0D73915B0F7B8F, 0x630D734D52CB5ACB,
};

u64 gGravestoneEarthTex[] = {
    0xB0A0A08080A0A090, 0x7090807080907050, 0x7080507080807070, 0x70A0809070707070,
    0xA0A09090B0C0A192, 0x9291B090A0709282, 0x7062A1818180B090, 0x80C0918180807080,
    0x8090A0B0B0B09192, 0xA281A192B1B39483, 0x839572A1A37494A3, 0xA3A3B384868682A0,
    0xA0A0C0B090909194, 0x63944677796B6F7D, 0x6D8F8F7F7F7F6F5F, 0x5F5F6F9F4F5F6F7F,
    0x90A0809081828356, 0x565B6F6F6F6F5F9F, 0x9F8F8F6F8FAF8F8F, 0x8F8F5F6F7F7F7F4F,
    0xA1A0725667596B5B, 0x5B5FCFAF9F7FAFBF, 0xAF7F9F9FAFBF9F9F, 0x7F5F7F9F7F7F7F4F,
    0x90916699797D7D69, 0x7B8FBFAFAF8F9F9F, 0xBF9FBF8F9FAFAFAF, 0x9F9FCF9F5F5F4F4F,
    0xC0B17587698D8D7B, 0x9D8F8FAF9FAF9FBF, 0xAF8FBF9FBF9FAFAF, 0x7F6F8F9F9F7F6F4F,
    0xA07277AB59597DAF, 0x8F9F9F6F8F8FBF8F, 0xAFAFBF8F8FBF8F7F, 0x8F9F5F5F4F7F6F4F,
    0x90528B5D43428B5F, 0x8F9F9F7F8FAFAF9F, 0x9F9FAFAF9FBF8FBF, 0x9F8F4F5F5F5F4F4F,
    0x8060887B7141676F, 0x9FAFAFAFBF8FAFAF, 0xAFBF9FAFAFBFAF9F, 0x7F7F5F5F5F5F5F4F,
    0x7052568D6563577F, 0xAFAF8F6F9FCF9FAF, 0x8FAF8F7FAF9F9F8F, 0x6F6F7F5F5F5F5F4F,
    0x4042668F6D6B8D9F, 0xAFAFBF9FCFBF8FCF, 0xBF9F8FAFBF9F9F9F, 0x6F7F7F6F6F6F4F4F,
    0x70648A9F8F9F7977, 0xAB9D8F9F9F8FBF9F, 0x7F7F8F9F9F7F9FAF, 0x6F7F7F6F6F5F4F4F,
    0x90586C7F9F7F4240, 0x4379BF7F7F6F5F5F, 0x8F7FAF9F8F5F7F8F, 0x9F7F5F6F6F6F4F4F,
    0xB0567A8A9F6F5230, 0x41599F9F8F8F8F7F, 0x8FBFBF9F8F8F9F7F, 0x6F6F6F5F5F4F3F4F,
    0x8064598C8F6F7773, 0x655D8F8F9F6F9F9F, 0xAFAF9FAF8F7F8F9F, 0xAF6F5F6F5F4F3F4F,
    0x707254889F8F6F7F, 0x6F8F9F8F7F9F7FAF, 0xBFAF8F9F9F8F8F7F, 0x8F6F6F5F6F4F5F4F,
    0x90808064BFAFAF9F, 0x7FCF7F8F8F8F7F8F, 0xBFAF8FAF7F8FBF9F, 0x8F7F7F6F6F4F4F4F,
    0xA0B294687D7D9F8F, 0x9F6F8F8F8F7F6F7F, 0x9F6F8F9F8F9FBF9F, 0x7FAF7F6F6F5F5F4F,
    0xB094C8A74351649F, 0x7F7F8FBF7F8F7F9F, 0x7F4F9F8F9F9FAFBF, 0x7F8F5F7F7F4F4F4F,
    0x807266775140605F, 0x7F6F9F8F8F8F5F4F, 0x3F7F8F9F9FAFBF9F, 0x7F8F7F6F6F4F4F4F,
    0xA09298685240606F, 0x8FCF9F9F7F8F6F6F, 0x6F9FBF9FBF8F7F7F, 0x6F9F7F7F6F5F5F4F,
    0x708278898551647F, 0xAF7F8F5F8F7F7F7F, 0x9F8F9FAF9F8F8F8F, 0x7F7F7F6F5F7F5F4F,
    0x90705679BD9B8D8F, 0x5F7F4F8F8F9F8F8F, 0x9F7F7FAF9F7F8F9F, 0x6F8F7F4F5F5F6F4F,
    0x8080567F7F9F5F6F, 0x6F8F5F7F8F7F9F9F, 0x7F7F6F5F9F8FAFAF, 0xAF9F7F4F5F5F5F4F,
    0x809072696D5F5957, 0x8D9F8F8F9F8F8F8F, 0x9F8F6FAF9F8FAF7F, 0xAFAF8F6F5F5F5F3F,
    0x8070719245475161, 0x575F8F9F5F7FAF8F, 0x6F8FAF5F9F9FAF9F, 0x7F6F9F7F6F7F5F4D,
    0x6090809061617050, 0x545D5C4C4D6F6F6F, 0x9F6F5F8F7F6F5F4F, 0x5C8D6F7F5F4E4F5E,
    0x50808070808090A0, 0x636958585B6B4A54, 0x6252625746665B4D, 0x4D4B4D5E5D6F5E88,
    0x808080A090708070, 0xB09282628292A290, 0x607090A0D07173A2, 0xB572538365748493,
    0x707090907090A0A0, 0x7080709080A08070, 0xB0A09090B0A09090, 0xB080907080607070,    
};

u64 gGravestoneTombTex[] = {
    0xAD69CE31B5EDC62F, 0xCE6FCDEDD6B3CDEF, 0xB5ABDEF5B525CDEB, 0xC5EBA45FB525CDED,
    0xE6F3EF37DEB5DEB3, 0xCDEDACE58C1FCE2F, 0xCE2D9CA19461A4E5, 0xA5278461B569BDAB,
    0x6B5B7B5B73595AD5, 0x735962D562916B17, 0x7359735973997B59, 0x7B595A936AD56AD3,
    0x5A93839B5A517317, 0x6B177B596AD37B99, 0x83DDAD25ACE5C5AB, 0xA4E3A4E5C5EDAD69,
    0xDEF5D62FDE71DEB1, 0xD62DCE6FD671C66F, 0xD6B1DEF5DEB5C62D, 0xC62FD671DEB1DEF3,
    0x9CA1DE71C5EBD62D, 0xA4A3AD27BDA9AD25, 0x73596B5994A1ACE5, 0xAD27AD27D671DEF5,
    0xAD6962D7AD259461, 0x62D79C61C5ED62D5, 0x9C61D6736AD76293, 0xC62FBDA96AD55A53,
    0x6AD5A4E35A957319, 0x6251ACE5841F5251, 0x9C618BDF62D56B19, 0xBE31B527D62FD6B3,
    0x8C5F6B599CE3C5AB, 0x6AD7C5A9C5A96B15, 0x8C1FBD6773195A53, 0x9C61C5ED5A5349CF,
    0xB527C5AD7B5B7359, 0x62D5C5EDBDAB6315, 0x8359AD67946183DD, 0x5AD5A4A3D671B569,
    0xA4E5A4A39CE3A4E5, 0xB527C5EDC5ABBDAB, 0xB569B56BD671EF37, 0xDEB5B5ABA461C569,
    0xCE2FBDEBDEB1DEB3, 0xC5AB9CA3CE71D6B3, 0xCE71C5EFA5278C61, 0xBDA95AD5BDADB527,
    0x8C1FDE7183DD739B, 0x6B59AD67739B7B9D, 0x739BA5276B595AD5, 0x7BDDD6B383DF7359,
    0x83DDCDED63177BDD, 0xDEF5DEF58C617BDD, 0x945FB5ABA527BDA9, 0xCE2F739BBDEDCEB3,
    0x941FCE2D8C1DBD67, 0x839BAD297359A4A5, 0x6B59BD69BDED6317, 0xBDEDC5ABBDEF7B9B,
    0xDE71C5ED735BD671, 0xCE2FC567E6F5D66F, 0xBD69BDA99CA1841D, 0x946383DBCE71B56B,
    0x9461BDA983DD841F, 0x739BC5ED7B9BBDAB, 0x7B9BB56B735B6B17, 0x739BB5AB839B7B9B,
    0xCE2F7BDD5A93739B, 0xC5AB9CA383DF841F, 0x63176B59841F8C61, 0xAD2762D3CE319CE5,
    0xCE71DE71CE2FB569, 0x9CA5AD67AD69BDAB, 0xAD69A527C5EDB527, 0xBDABD6B3CE71ACE5,
    0x83DDCDEDCE2FC5ED, 0xDEF5DEF5EF37BDAD, 0xB567B5ABA527A4E5, 0xAD27739BDE31CE71,
    0xD6B3CE2DA525BD67, 0xC567AD2983DDA4A5, 0x9CE5BD69BDEDDEB3, 0xBDEDC5ABBDEFB56B,
    0xDE71C5EDD6B3D671, 0xCE2FC567E6F5D66F, 0xBD69BDA99CA194A3, 0x9CE583DDB569D671,
    0xB5ABA4A39CE3A4E5, 0xB527C5EDC5ABBDAB, 0xB569B56BD671EF37, 0xDEB5B5AB8BDDC569,
    0xCE2FBDEBDEB1DEB3, 0xC5AB9CA3CE71D6B3, 0xCE71C5EFA527AD69, 0x945F5A53DEB59CA3,
    0x5AD562D5C5AB62D5, 0x5B176B17BDA97359, 0x9CA37BDD6B17941F, 0x7B9B5A937359A527,
    0xCDABCE71DEF5B529, 0xCE3194A3A4E5AD27, 0x9CA394A39CE5ADAB, 0xC5ED5AD5BDABAD69,
    0xC5AB5251C5EDB5A9, 0x62D59CA16B9B9461, 0x73596AD57317DEB3, 0xC5AB5A919C614A0F,
    0x94A39CE7DEF5BD6B, 0xAD699CA5941F9461, 0xDEB3AD69BDEDD6B3, 0xACE762D7BD69B569,
    0x5AD57359B567DEB3, 0x6315A525739B9CA3, 0x83DDDEF5C62F8C1D, 0xD67173599CA36B19,
    0xA5ADE737D673C5AD, 0xA4E7A4E5CE2F8C1F, 0x739D9CE5C5EFCE2F, 0xBE2F6317C62FD671,
    0xCE2FB525CE2F941F, 0x9CA1BDABB56994A3, 0xA4E5B5EDBDEDCDED, 0xB569BDA9B5ABB5AD,
    0x94A394639461AD27, 0xB56BA4E5BDAB83DD, 0x62D79CA394A39CA3, 0xB5276317D671BDAB,
    0xBDEDD6B3DEB3DEB3, 0xD6B1BD69B569A527, 0xB569BDABCE2FA4E5, 0xB527D6318C218C61,
    0xAD6BBDABCE319C63, 0x9CA58BDFBD699C63, 0x52937B9DACE78C21, 0x6B595AD5BDADCE2F,
    0x6B599CE7DEF5D671, 0xCE31CE71A5279CA3, 0xA4A3AD259CE5CE71, 0xC5EDAD27B569BDAD,
    0xC5AB6B9BCDEFB56B, 0x7B9B9CA3AD2783DF, 0x5A9583DFB56B83DD, 0x941F6B19BDABBE2F,
    0x8C616B579CA3BDAD, 0xA4E5A4A3B5ABAD69, 0xD673C62DB5ABD671, 0xCE2F8C1FAD279D29,
    0xAD6994617359C5AD, 0xB569CDEF9CA37317, 0x735BBDEDA5277359, 0x8C1F6B19D671CE2F,
    0xBDEDB5697359839B, 0xDEB5D6B3D6739CE7, 0x83DDDEB5CE31D6B3, 0xAD6994A3AD27AD6B,
    0xB4E5AD277B9BC5EF, 0xCE2FDE73735B6317, 0x9CA5CE2F94A36B19, 0x8BDD8BDFCE31C5ED,
    0x8C619CE55A937317, 0x8BDDCDABBD27AD69, 0xBDABA4E5C5EDCE31, 0xDEB3DEB5DE71D673,
    0xC5AB83DD7BDDA4E5, 0xB5AD94A37319A4E7, 0xB56BAD277B9D735B, 0xA569C5EDEF7BE6F5,
    0xBDEF6B198C61BDAB, 0x941F6AD5BD27B569, 0xC62FCE2FDE739CA3, 0xA461BDABACE5A4E5,
    0x7B5962D58C1FBDAD, 0x8C63A4E5BDABAD29, 0x9CA562D762D5B569, 0xACE76359D6B3CE71,
    0x62D79CA5AD27D6B3, 0xB569AD238B57B5AD, 0xC5EFC673AD67AD67, 0xACE5B527A4E76B17,
    0x629562D59C5FB569, 0xC62FBDABB569A4A5, 0x7B9B8C1FBDABACE7, 0x7B9BAD25BDABDEF5,
    0x94A5735983DF83DF, 0x94A37BDDB527941F, 0xAD27B525D671DEB3, 0xA4617B5B5B176AD7,
    0x839B839BA4A39C61, 0x83DD8BDF94619461, 0xBD69A4E78C1F62D7, 0x7B9B8BDF9CA3B569,
    0xB569BDADC5EFAD29, 0xB56BE6F7DEB1CE2F, 0x9461B527839B6B15, 0x62D56AD5839B7BDD,
    0xAD699CA3B527AD6B, 0xB529AD69B52983DD, 0x839D62D55A957359, 0xB56983DFCE31AD27,
    0xB569BDAD9CA394A3, 0x839B83DD739D6B15, 0x52515A9352517B9B, 0x841D839B8BDDACE5,
    0xB569AD29ACA38C61, 0x94617BDD7B9B6AD7, 0x6317841FC5ABBDAB, 0x839D6B19D671AD29,
    0x63195A956B176B19, 0x5293529363177359, 0x7B9973598C1FACE5, 0x9CE5C5EDD631BD6B,
    0xC5ADA4A58C1F9461, 0x83DF7B9D8C21B5AD, 0xBE2FADAD946183DD, 0x6B1962D7B5279CA3,
    0x945F839D73DD8C21, 0x8C61B5ABCE71C5ED, 0xD5EDCE71A4E5CE71, 0xDEB3C5EBDE71DEF5,
    0xDEB394639CA3A4E7, 0xCE31BDADAD2783DD, 0x73596B177B5B7359, 0x7B9B7319C5EDAD69,
    0xBD69C631C631BDED, 0xC62FD6B3DEF5E737, 0xDEB5D673D6B3BDED, 0xD6B3DEF5E6F5D671,
    0xBDABC5ADCE2FC5ED, 0xAD69AD27841F7B9B, 0x83DD73199CA1A4E5, 0xA4A36B57D6B3E737,
    0xC62FCE31DEB5C62F, 0xBDEFB569BDADB529, 0xD6B3CE2FC5EDB5A9, 0xBDADBDADA52794A5,
    0x94A394618C1F9421, 0x9C63946383DF735B, 0x941F941FB529BDAB, 0x73196B17D671E6F5,
    0xD6B3DEB3B5ABAD27, 0x8C619CA5A4A3A4E3, 0xAD279CA38C1F8C1D, 0xA4E59CA36B5B841F,
    0x6B19739B6B59735B, 0x735B735B7359739B, 0x7B9B9CA373597359, 0x8C1FAD27DEF7E6F7,
    0xCE71C5ABDE73DEB3, 0xDEF3D66FCE2FCE71, 0xDEB5DEB3A52794A3, 0xAD29B56BCE31CEB5,
    0xAD6BBDEFCE71E739, 0xEF39D6B5B5EFCE71, 0xD673D6B5DEF7D671, 0x7C1F8C61DEF7E737,
};

Gfx gGravestoneStoneDL[] = {
    gsDPPipeSync(),
    gsDPSetTextureLUT(G_TT_NONE),
    gsSPTexture(0xFFFF, 0xFFFF, 0, G_TX_RENDERTILE, G_ON),
    gsDPLoadTextureBlock(gGravestoneGrassTex, G_IM_FMT_RGBA, G_IM_SIZ_16b, 16, 32, 0, G_TX_NOMIRROR | G_TX_WRAP,
                         G_TX_MIRROR | G_TX_WRAP, 4, 5, G_TX_NOLOD, G_TX_NOLOD),
    gsDPSetCombineLERP(TEXEL0, 0, SHADE, 0, 0, 0, 0, 1, COMBINED, 0, PRIMITIVE, 0, 0, 0, 0, COMBINED),
    gsDPSetRenderMode(G_RM_FOG_SHADE_A, G_RM_AA_ZB_OPA_SURF2),
    gsSPClearGeometryMode(G_TEXTURE_GEN | G_TEXTURE_GEN_LINEAR),
    gsSPSetGeometryMode(G_CULL_BACK | G_FOG | G_LIGHTING),
    gsDPSetPrimColor(0, 0, 215, 220, 210, 255),
    gsSPVertex(object_hakaVtx_000000, 19, 0),
    gsSP2Triangles(0, 1, 2, 0, 3, 4, 5, 0),
    gsSP2Triangles(6, 7, 8, 0, 6, 8, 9, 0),
    gsSP2Triangles(10, 11, 12, 0, 13, 14, 12, 0),
    gsSP2Triangles(15, 16, 17, 0, 15, 17, 18, 0),
    gsDPPipeSync(),
    gsDPLoadTextureBlock(gGravestoneTombTex, G_IM_FMT_RGBA, G_IM_SIZ_16b, 32, 32, 0, G_TX_MIRROR | G_TX_WRAP,
                         G_TX_NOMIRROR | G_TX_WRAP, 5, 5, G_TX_NOLOD, G_TX_NOLOD),
    gsSPVertex(&object_hakaVtx_000000[19], 4, 0),
    gsSP2Triangles(0, 1, 2, 0, 0, 2, 3, 0),
    gsSPEndDisplayList(),
};

Gfx gGravestoneEarthDL[] = {
    gsDPPipeSync(),
    gsDPSetTextureLUT(G_TT_NONE),
    gsSPTexture(0xFFFF, 0xFFFF, 0, G_TX_RENDERTILE, G_ON),
    gsDPLoadTextureBlock(gGravestoneEarthTex, G_IM_FMT_IA, G_IM_SIZ_8b, 32, 32, 0, G_TX_NOMIRROR | G_TX_CLAMP,
                         G_TX_NOMIRROR | G_TX_CLAMP, 5, 5, G_TX_NOLOD, G_TX_NOLOD),
    gsDPSetCombineLERP(TEXEL0, 0, SHADE, 0, 0, 0, 0, TEXEL0, COMBINED, 0, PRIMITIVE, 0, 0, 0, 0, COMBINED),
    gsDPSetRenderMode(G_RM_FOG_SHADE_A, G_RM_AA_ZB_XLU_DECAL2),
    gsSPClearGeometryMode(G_TEXTURE_GEN | G_TEXTURE_GEN_LINEAR),
    gsSPSetGeometryMode(G_CULL_BACK | G_FOG | G_LIGHTING),
    gsDPSetPrimColor(0, 0, 221, 194, 153, 255),
    gsSPVertex(&object_hakaVtx_000000[23], 4, 0),
    gsSP2Triangles(0, 1, 2, 0, 0, 2, 3, 0),
    gsSPEndDisplayList(),
};

u8 object_haka_possiblePadding_000338[] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
};

BgCamInfo gGravestoneColCamDataList[] = {
    { 0x0000, 0, NULL },
};

SurfaceType gGravestoneColSurfaceType[] = {
    {0x00000000, 0x000007C2},   {0x00E00000, 0x000007C2},
};

CollisionPoly gGravestoneColPolygons[] = {
    {0x0000, 0x2000, 0x0001, 0x0002, 0x0000, 0x71B4, 0x3AC7, 0xFEFB},
    {0x0000, 0x2000, 0x0002, 0x0003, 0x0000, 0x71B4, 0x3AC7, 0xFEFB},
    {0x0000, 0x2004, 0x0005, 0x0001, 0x0000, 0x37F5, 0x731E, 0xFEBC},
    {0x0000, 0x2004, 0x0001, 0x0000, 0x0000, 0x37F5, 0x731E, 0xFEBC},
    {0x0000, 0x2006, 0x0004, 0x0000, 0x8787, 0x2A22, 0xF64C, 0xFED6},
    {0x0000, 0x2003, 0x0006, 0x0000, 0x806E, 0x0A19, 0xFD5F, 0xFEDA},
    {0x0001, 0x2002, 0x0007, 0x0006, 0x0000, 0x0000, 0x8001, 0xFE98},
    {0x0001, 0x2002, 0x0006, 0x0003, 0x0000, 0x0000, 0x8001, 0xFE98},
    {0x0000, 0x2001, 0x0005, 0x0007, 0x7769, 0x2D14, 0xF662, 0xFED8},
    {0x0000, 0x2001, 0x0007, 0x0002, 0x7F95, 0x0A1A, 0xFE28, 0xFEDC},
};

Vec3s gGravestoneColVertices[] = {
    {   -290,    144,    290 },
    {    286,    144,    290 },
    {    250,    480,   -360 },
    {   -250,    480,   -360 },
    {   -346,      0,    360 },
    {    346,      0,    360 },
    {   -288,      0,   -360 },
    {    288,      0,   -360 },
};

CollisionHeader gGravestoneCol = { 
    { -346, 0, -1128 },
    { 346, 480, 360 },
    ARRAY_COUNT(gGravestoneColVertices), gGravestoneColVertices,
    ARRAY_COUNT(gGravestoneColPolygons), gGravestoneColPolygons,
    gGravestoneColSurfaceType,
    gGravestoneColCamDataList,
    0, NULL
};

/* END OBJECT_HAKA */

static InitChainEntry sInitChain[] = {
    ICHAIN_F32(terminalVelocity, 0, ICHAIN_CONTINUE),
    ICHAIN_VEC3F_DIV1000(scale, 100, ICHAIN_STOP),
};

void BgHaka_Init(Actor* thisx, PlayState* play) {
    BgHaka* this = (BgHaka*)thisx;
    s32 pad;
    CollisionHeader* colHeader = NULL;

    Actor_ProcessInitChain(&this->dyna.actor, sInitChain);
    DynaPolyActor_Init(&this->dyna, 0);
    CollisionHeader_GetVirtual(&gGravestoneCol, &colHeader);
    this->dyna.bgId = DynaPoly_SetBgActor(play, &play->colCtx.dyna, &this->dyna.actor, colHeader);
    this->actionFunc = BgHaka_IdleClosed;
}

void BgHaka_Destroy(Actor* thisx, PlayState* play) {
    BgHaka* this = (BgHaka*)thisx;

    DynaPoly_DeleteBgActor(play, &play->colCtx.dyna, this->dyna.bgId);
}

void BgHaka_CheckPlayerOnDirtPatch(BgHaka* this, Player* player) {
    Vec3f playerRelativePos;

    Actor_WorldToActorCoords(&this->dyna.actor, &playerRelativePos, &player->actor.world.pos);
    if (fabsf(playerRelativePos.x) < 34.6f && playerRelativePos.z > -112.8f && playerRelativePos.z < -36.0f) {
        player->stateFlags2 |= PLAYER_STATE2_FORCE_SAND_FLOOR_SOUND;
    }
}

void BgHaka_IdleClosed(BgHaka* this, PlayState* play) {
    Player* player = GET_PLAYER(play);

    if (this->dyna.pushForce != 0.0f) {
        if (/*play->sceneId == SCENE_GRAVEYARD && !LINK_IS_ADULT && IS_DAY*/false) {
            this->dyna.pushForce = 0.0f;
            player->stateFlags2 &= ~PLAYER_STATE2_10;
            if (!Play_InCsMode(play)) {
                Message_StartTextbox(play, 0x5073, NULL);
                this->dyna.actor.params = 100; // Used as a cooldown for displaying Graveyard Boy's warning
                this->actionFunc = BgHaka_IdleLockedClosed;
            }
        } else if (0.0f < this->dyna.pushForce ||
                   (/*play->sceneId == SCENE_LAKE_HYLIA && !LINK_IS_ADULT && !Flags_GetSwitch(play, 0x23)*/false)) {
            this->dyna.pushForce = 0.0f;
            player->stateFlags2 &= ~PLAYER_STATE2_10;
        } else {
            this->dyna.actor.world.rot.y = this->dyna.actor.shape.rot.y + 0x8000;
            this->actionFunc = BgHaka_Pull;
        }
    }
    BgHaka_CheckPlayerOnDirtPatch(this, player);
}

void BgHaka_Pull(BgHaka* this, PlayState* play) {
    Player* player = GET_PLAYER(play);
    s32 reachedMaxPullDist;

    this->dyna.actor.speed += 0.05f;
    this->dyna.actor.speed = CLAMP_MAX(this->dyna.actor.speed, 1.5f);
    // terminalVelocity is used to keep track of the distance pulled from home
    reachedMaxPullDist = Math_StepToF(&this->dyna.actor.terminalVelocity, 60.0f, this->dyna.actor.speed);
    this->dyna.actor.world.pos.x =
        Math_SinS(this->dyna.actor.world.rot.y) * this->dyna.actor.terminalVelocity + this->dyna.actor.home.pos.x;
    this->dyna.actor.world.pos.z =
        Math_CosS(this->dyna.actor.world.rot.y) * this->dyna.actor.terminalVelocity + this->dyna.actor.home.pos.z;
    if (reachedMaxPullDist) {
        this->dyna.pushForce = 0.0f;
        player->stateFlags2 &= ~PLAYER_STATE2_10;
        if (this->dyna.actor.params == 1) {
            Audio_PlaySfx(NA_SE_SY_CORRECT_CHIME);
        } else if (/*!IS_DAY && play->sceneId == SCENE_GRAVEYARD*/false) {
            Actor_Spawn(&play->actorCtx, play, ACTOR_EN_POH, this->dyna.actor.home.pos.x, this->dyna.actor.home.pos.y,
                        this->dyna.actor.home.pos.z, 0, this->dyna.actor.shape.rot.y, 0, 1);
        }
        this->actionFunc = BgHaka_IdleOpened;
    }
    Actor_PlaySfx_Flagged(&this->dyna.actor, NA_SE_EV_ROCK_SLIDE - SFX_FLAG);
}

void BgHaka_IdleOpened(BgHaka* this, PlayState* play) {
    Player* player = GET_PLAYER(play);

    if (this->dyna.pushForce != 0.0f) {
        this->dyna.pushForce = 0.0f;
        player->stateFlags2 &= ~PLAYER_STATE2_10;
    }
}

void BgHaka_IdleLockedClosed(BgHaka* this, PlayState* play) {
    Player* player = GET_PLAYER(play);
    s32 pad;

    if (this->dyna.actor.params != 0) {
        this->dyna.actor.params--;
    }
    if (this->dyna.pushForce != 0.0f) {
        this->dyna.pushForce = 0.0f;
        player->stateFlags2 &= ~PLAYER_STATE2_10;
    }
    if (this->dyna.actor.params == 0) {
        this->actionFunc = BgHaka_IdleClosed;
    }
    BgHaka_CheckPlayerOnDirtPatch(this, player);
}

void BgHaka_Update(Actor* thisx, PlayState* play) {
    BgHaka* this = (BgHaka*)thisx;

    this->actionFunc(this, play);
}

void BgHaka_Draw(Actor* thisx, PlayState* play) {
    OPEN_DISPS(play->state.gfxCtx);

    Gfx_SetupDL25_Opa(play->state.gfxCtx);
    Gfx_SetupDL25_Xlu(play->state.gfxCtx);

    MATRIX_FINALIZE_AND_LOAD(POLY_OPA_DISP++, play->state.gfxCtx);
    gSPDisplayList(POLY_OPA_DISP++, gGravestoneStoneDL);
    Matrix_Translate(0.0f, 0.0f, thisx->terminalVelocity * 10.0f, MTXMODE_APPLY);
    MATRIX_FINALIZE_AND_LOAD(POLY_XLU_DISP++, play->state.gfxCtx);
    gSPDisplayList(POLY_XLU_DISP++, gGravestoneEarthDL);

    CLOSE_DISPS(play->state.gfxCtx);
}
